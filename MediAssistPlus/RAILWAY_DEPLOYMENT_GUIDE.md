# Railway Deployment Guide for MediAssist+ Backend

## Prerequisites
âœ… GitHub repository: https://github.com/Chandru2600/MediAssistPlus
âœ… Railway account (free tier available)
âœ… All environment variables ready

## Step-by-Step Deployment

### 1. Create Railway Account
1. Go to https://railway.app/
2. Click "Login" â†’ "Login with GitHub"
3. Authorize Railway to access your GitHub

### 2. Create New Project
1. Click "New Project"
2. Select "Deploy from GitHub repo"
3. Choose `Chandru2600/MediAssistPlus`
4. Railway will detect your repository

### 3. Configure Root Directory
Since your backend is in a subdirectory:
1. Click on your service
2. Go to "Settings" tab
3. Find "Root Directory"
4. Set to: `backend`
5. Click "Save"

### 4. Add PostgreSQL Database
1. In your project, click "New"
2. Select "Database" â†’ "Add PostgreSQL"
3. Railway will create a database
4. It will auto-generate `DATABASE_URL`

### 5. Configure Environment Variables
Click "Variables" tab and add these:

```env
# Database (Auto-generated by Railway)
DATABASE_URL=postgresql://... (Railway provides this)

# JWT
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# Google Cloud
GOOGLE_CLOUD_API_KEY=your-google-cloud-api-key

# AWS S3
AWS_REGION=eu-north-1
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
S3_BUCKET_NAME=mediassist-uploads-2025

# Ollama (Optional - if you have remote Ollama)
OLLAMA_URL=http://your-ollama-server:11434

# Port (Railway auto-assigns)
PORT=${{PORT}}
```

**Important Notes:**
- `DATABASE_URL` is automatically provided by Railway's PostgreSQL
- `PORT` uses Railway's variable `${{PORT}}`
- Copy your actual values from `backend/.env`

### 6. Deploy
1. Railway will automatically deploy
2. Watch the build logs
3. Wait for "Success" message

### 7. Get Your Deployment URL
1. Go to "Settings" tab
2. Find "Domains" section
3. Click "Generate Domain"
4. You'll get: `https://your-app.railway.app`

### 8. Run Database Migrations
Railway automatically runs migrations during deployment via the build command.

If you need to run manually:
1. Go to your service
2. Click "..." â†’ "Run Command"
3. Enter: `npx prisma migrate deploy`

### 9. Test Your Deployment
```bash
# Test health endpoint
curl https://your-app.railway.app/api/health

# Test signup
curl -X POST https://your-app.railway.app/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{"name":"Test Doctor","email":"test@example.com","password":"password123"}'
```

### 10. Update Your Mobile App
Update `app.json` or `.env` in your mobile app:
```env
API_URL=https://your-app.railway.app/api
```

## Troubleshooting

### Build Fails
- Check build logs in Railway dashboard
- Ensure `railway.json` is in `backend/` folder
- Verify `package.json` has all dependencies

### Database Connection Error
- Check `DATABASE_URL` is set
- Ensure PostgreSQL addon is added
- Run migrations manually if needed

### Environment Variables Not Working
- Double-check all variables are set
- No quotes around values
- Restart deployment after adding variables

### S3 Upload Works! ðŸŽ‰
Railway servers have correct time (2024), so S3 uploads will work automatically!

## Monitoring

### View Logs
1. Click on your service
2. Go to "Deployments" tab
3. Click on latest deployment
4. View real-time logs

### Check Metrics
1. Go to "Metrics" tab
2. See CPU, Memory, Network usage

## Cost Information

### Free Tier
- $5 credit per month
- Enough for development/testing
- ~500 hours of runtime

### Paid Plans
- Hobby: $5/month (500 hours)
- Pro: $20/month (unlimited)

## Important Files

Your project already has these configured:
- âœ… `backend/railway.json` - Railway configuration
- âœ… `backend/Procfile` - Process commands
- âœ… `backend/package.json` - Dependencies
- âœ… `backend/prisma/schema.prisma` - Database schema

## Next Steps After Deployment

1. **Test All Endpoints**: Verify auth, patients, recordings
2. **Update Mobile App**: Point to Railway URL
3. **Build APK**: With production backend URL
4. **Monitor**: Check logs and metrics regularly

## Rollback (If Needed)
1. Go to "Deployments" tab
2. Find previous working deployment
3. Click "..." â†’ "Redeploy"

---

## Quick Reference

**Your GitHub Repo**: https://github.com/Chandru2600/MediAssistPlus
**Railway Dashboard**: https://railway.app/dashboard
**Backend Path**: `backend/`
**Database**: PostgreSQL (auto-provisioned)

**Support**: https://docs.railway.app/
